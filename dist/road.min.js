var road=function(){function o(t,e){try{for(var o in t)e.hasOwnProperty(o)&&(e[o]=t[o])}catch(n){throw n}}function n(t){if(!t)throw"Missing cuid";if("number"==typeof t)throw"cuid value should be String"}var t=[],e=[];return Array.prototype.distinct=function(){var e,o,n,t=[this[0]];for(e=1;e<this.length;e++){for(n=1,o=0;o<t.length;o++)if(this[e]==t[o]){n=0;break}n&&t.push(this[e])}return t},Array.prototype.unique=function(){var t=JSON.stringify(this);return t=JSON.parse(t),this.forEach(function(e){var o=t.filter(function(t){return JSON.stringify(t)===JSON.stringify(e)});if(o.length>1)for(var n=0;n<o.length-1;n++){var r=t.indexOf(o[n]);t.splice(r,1)}}),t},{add:function(e,o,n){try{o=o||{},o.sendBack=o.sendBack||!1,n=n||"new";var r=0;if(!e)throw"Missing object to be included";if(r=e.length||1,r>1)for(var f=0;r>f;f++){"recovered"!=n&&(e[f].cuid=cuid()),e[f].status=n;var i={};$.extend(i,e[f]),t.push(i),"function"==typeof o.ok&&o.ok(i)}else{"recovered"!=n&&(e.cuid=cuid()),e.status=n;var i={};$.extend(i,e),t.push(i),"function"==typeof o.ok&&o.ok(i)}if(o.sendBack)return e;"function"==typeof o.end&&o.end(e)}catch(a){throw"function"==typeof o.err&&o.err(a),a}},remove:function(o,r){try{if(r=r||{},n(o),0==this.length())throw"No data in memory";var f=t.map(function(t){return t.cuid}).indexOf(o);if(!(f>=0))return null;var i=this.getByCUID(o);i.status="removed",e.push(i),t.splice(f,1),"function"==typeof r.ok&&r.ok(i),"function"==typeof r.end&&r.end()}catch(a){throw"function"==typeof r.err&&r.err(a),a}},update:function(t,e,n){try{if(n=n||{},!t)throw"Missing object";if(e&&"number"==typeof e)throw"cuid value should be String";var r=0;if(!t)throw"Missing object to be included";if(r=t.length||1,r>1)for(var f=0;r>f;f++){if(!t[f].cuid)throw"For array updates it is required the cuid property on each object.";var i=this.getByCUID(t[f].cuid,!1);if(void 0==i)throw"No item found for cuid "+e.toString();o(t[f],i),i.status="changed","function"==typeof n.ok&&n.ok(i)}else{if(!t.cuid&&!e)throw"Missing cuid";!e&&t.cuid&&(e=e||t.cuid);var i=this.getByCUID(e.toString(),!1);if(void 0==i)throw"No item found for cuid "+e.toString();o(t,i),i.cuid=e.toString(),i.status="changed","function"==typeof n.ok&&n.ok(i)}"function"==typeof n.end&&n.end()}catch(a){throw"function"==typeof n.err&&n.err(a),a}},"delete":function(t,e){try{e=e||{},n(t);var o=this.getByCUID(t,!1);if(void 0==o||o==[])throw"No item found for cuid "+t.toString();o.cuid=t,o.status="deleted","function"==typeof e.ok&&e.ok(o),"function"==typeof e.end&&e.end()}catch(r){throw"function"==typeof e.err&&e.err(r),r}},setData:function(e,o){try{o=o||{},t=[],t=this.add(e,{sendBack:!0},"origin"),"function"==typeof o.ok&&o.ok(t),"function"==typeof o.end&&o.end()}catch(n){throw"function"==typeof o.err&&o.err(n),n}},getAll:function(e){try{return e=e||{},"function"==typeof e.ok&&e.ok(t),"function"==typeof e.end&&e.end(),t}catch(o){throw"function"==typeof e.err&&e.err(o),o}},getByCUID:function(e,o,r){try{r=r||{},void 0==o&&(o=!0),n(e);var f=t.filter(function(t){return t.cuid==e})[0];if(!f)throw"No item found for cuid "+e;if(o){var i={};return $.extend(i,f),"function"==typeof r.ok&&r.ok(i),"function"==typeof r.end&&r.end(),i}return"function"==typeof r.ok&&r.ok(f),"function"==typeof r.end&&r.end(),f}catch(a){throw"function"==typeof r.err&&r.err(a),a}},length:function(e){try{return e=e||{},"function"==typeof e.ok&&e.ok(t.length),"function"==typeof e.end&&e.end(),t.length}catch(o){throw"function"==typeof e.err&&e.err(o),o}},filter:function(e,o){try{o=o||{};var n=[],r=[];return $.extend(r,t),r.forEach(function(t){e(t)&&("function"==typeof o.ok&&o.ok(t),n.push(t))}),"function"==typeof o.end&&o.end(n),n}catch(f){throw"function"==typeof o.err&&o.err(f),f}},map:function(e,o){try{o=o||{};var r=[];$.extend(r,t);var f=r.map(e);return"function"==typeof o.ok&&o.ok(f),"function"==typeof o.end&&o.end(),f}catch(i){throw"function"==typeof o.err&&o.err(i),i}},uniqueProp:function(e,o){try{o=o||{};if(void 0==e)throw"Missing property name.";if("string"!=typeof e||0==e.length)throw"Property name should be String";var r=[];$.extend(r,t);var f=r.map(function(t){return t[e]}).distinct();return"function"==typeof o.ok&&o.ok(f),"function"==typeof o.end&&o.end(),f}catch(i){throw"function"==typeof o.err&&o.err(i),i}},getAllRemoved:function(t){try{return t=t||{},"function"==typeof t.ok&&t.ok(e),"function"==typeof t.end&&t.end(),e}catch(o){throw"function"==typeof t.err&&t.err(o),o}},getRemovedByCUID:function(t,o,r){try{r=r||{},void 0==o&&(o=!0),n(t);var f=e.filter(function(e){return e.cuid==t})[0];if(!f)throw"No item found for cuid "+t;if(o){var i={};return $.extend(i,f),"function"==typeof r.ok&&r.ok(i),"function"==typeof r.end&&r.end(),i}return"function"==typeof r.ok&&r.ok(f),"function"==typeof r.end&&r.end(),f}catch(a){throw"function"==typeof r.err&&r.err(a),a}},cleanRemoved:function(t){try{t=t||{},"function"==typeof t.ok&&t.ok(),"function"==typeof t.end&&t.end(),e=[]}catch(o){throw"function"==typeof t.err&&t.err(o),o}},lengthRemoved:function(t){try{return t=t||{},"function"==typeof t.ok&&t.ok(e.length),"function"==typeof t.end&&t.end(),e.length}catch(o){throw"function"==typeof t.err&&t.err(o),o}},destroyRemovedByCUID:function(t,o){try{if(o=o||{},n(t),0==this.lengthRemoved())throw"No data in memory";var r=e.map(function(t){return t.cuid}).indexOf(t);if(!(r>=0))return null;e.splice(r,1),"function"==typeof o.ok&&o.ok(r),"function"==typeof o.end&&o.end()}catch(f){throw"function"==typeof o.err&&o.err(f),f}},recoverRemovedByCUID:function(t,e){try{if(e=e||{},n(t),0==this.lengthRemoved())throw"No data in memory";var o=this.getRemovedByCUID(t);if(!o)throw"No item found for cuid "+t.toString();this.add(o,null,"recovered"),this.destroyRemovedByCUID(t),"function"==typeof e.ok&&e.ok(o),"function"==typeof e.end&&e.end()}catch(r){throw"function"==typeof e.err&&e.err(r),r}},recoverAllRemoved:function(t){try{if(t=t||{},0==this.lengthRemoved())throw"No data in memory";for(var o=0;o<this.lengthRemoved();o++)this.add(e[o],null,"recovered"),"function"==typeof t.ok&&t.ok(e[o]);this.cleanRemoved(),"function"==typeof t.end&&t.end()}catch(n){throw"function"==typeof t.err&&t.err(n),n}},filterRemoved:function(t,o){try{o=o||{};var n=[],r=[];return $.extend(r,e),r.forEach(function(e){t(e)&&("function"==typeof o.ok&&o.ok(e),n.push(e))}),"function"==typeof o.end&&o.end(n),n}catch(f){throw"function"==typeof o.err&&o.err(f),f}},mapRemoved:function(t,o){try{o=o||{};var r=[];$.extend(r,e);var f=r.map(t);return"function"==typeof o.ok&&o.ok(f),"function"==typeof o.end&&o.end(),f}catch(i){throw"function"==typeof o.err&&o.err(i),i}},uniquePropRemoved:function(t,o){try{o=o||{};if(void 0==t)throw"Missing property name.";if("string"!=typeof t||0==t.length)throw"Property name should be String";var r=[];$.extend(r,e);var f=r.map(function(e){return e[t]}).distinct();return"function"==typeof o.ok&&o.ok(f),"function"==typeof o.end&&o.end(),f}catch(i){throw"function"==typeof o.err&&o.err(i),i}},isLocalStorageSupported:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){throw"function"==typeof fun.err&&fun.err(t),t}},saveLocalStorage:function(o){try{if(o=o||{},!this.isLocalStorageSupported())throw"No local storage supported.";localStorage.live=JSON.stringify(t),localStorage.removed=JSON.stringify(e),"function"==typeof o.ok&&o.ok(),"function"==typeof o.end&&o.end()}catch(n){throw"function"==typeof o.err&&o.err(n),n}},loadLocalStorage:function(o){try{if(o=o||{},!this.isLocalStorageSupported())throw"No local storage supported.";t=[],e=[],t=JSON.parse(localStorage.live),e=JSON.parse(localStorage.removed),"function"==typeof o.ok&&o.ok(),"function"==typeof o.end&&o.end()}catch(n){throw"function"==typeof o.err&&o.err(n),n}},cleanLocalStorage:function(t){try{if(t=t||{},!this.isLocalStorageSupported())throw"No local storage supported.";localStorage.live=null,localStorage.removed=null,"function"==typeof t.ok&&t.ok(),"function"==typeof t.end&&t.end()}catch(e){throw"function"==typeof t.err&&t.err(e),e}},serverLoad:function(e,o){try{o=o||{};var n={};if(!e)throw"Missing ajax url parameter";n.async=!1,n.method="GET",n.url=e,t=[];var r=$.ajax(n).responseText;"string"==typeof r&&(r=JSON.parse(r)),r&&this.add(r,{},"origin"),"function"==typeof o.ok&&o.ok(r),"function"==typeof o.end&&o.end()}catch(f){throw"function"==typeof o.err&&o.err(f),f}},serverSendAll:function(e,o,n){try{n=n||{};var r={};if(void 0==o&&(o=!1),!e)throw"Missing ajax url parameter";if(!t||t==[])throw"No data found.";r.data=0==o?{data:t}:JSON.stringify(t),r.async=!1,r.method="POST",r.url=e;var f=$.ajax(r).responseText;return"function"==typeof n.ok&&n.ok(f),"function"==typeof n.end&&n.end(),f}catch(i){throw"function"==typeof n.err&&n.err(i),i}},serverSendAllMap:function(o,n,r,f){try{f=f||{};var i={};if(void 0==r&&(r=!1),!o)throw"Missing ajax url parameter";if(!t||t==[]&&!e||e==[])throw"No data found.";var a=[];this.filter(n).forEach(function(t){a.push(t)}),this.filterRemoved(n).forEach(function(t){a.push(t)}),i.data=0==r?{data:a.map(n)}:JSON.stringify(a.map(n)),i.async=!1,i.method="POST",i.url=o;var c=$.ajax(i).responseText;return"function"==typeof f.ok&&f.ok(c),"function"==typeof f.end&&f.end(),c}catch(u){throw"function"==typeof f.err&&f.err(u),u}},serverSendAllRemoved:function(t,o,n){try{n=n||{};var r={};if(void 0==o&&(o=!1),!t)throw"Missing ajax url parameter";if(!e||e==[])throw"No data found.";r.data=0==o?{data:e}:JSON.stringify(e),r.async=!1,r.method="POST",r.url=t;var f=$.ajax(r).responseText;return"function"==typeof n.ok&&n.ok(f),"function"==typeof n.end&&n.end(),f}catch(i){throw"function"==typeof n.err&&n.err(i),i}},serverSendFilter:function(o,n,r,f){try{f=f||{};var i={};if(void 0==r&&(r=!1),!o)throw"Missing ajax url parameter";if(!n)throw"Missing filter criteria parameter";if(!t||t==[]&&!e||e==[])throw"No data found.";var a=[];this.filter(n).forEach(function(t){a.push(t)}),this.filterRemoved(n).forEach(function(t){a.push(t)}),i.data=0==r?{data:a}:JSON.stringify(a),i.async=!1,i.method="POST",i.url=o;var c=$.ajax(i).responseText;return"function"==typeof f.ok&&f.ok(c),"function"==typeof f.end&&f.end(),c}catch(u){throw"function"==typeof f.err&&f.err(u),u}},serverSendByCUID:function(t,e,o,r){try{r=r||{};var f={};if(n(t),void 0==o&&(o=!1),!e)throw"Missing ajax url parameter";var i=this.getByCUID(t);if(i||(i=this.getRemovedByCUID(t)),"string"==typeof i)throw"No item found for cuid "+t;f.data=0==o?i:JSON.stringify(i),f.async=!1,f.method="POST",f.url=e;var a=$.ajax(f).responseText;return"function"==typeof r.ok&&r.ok(i,a),"function"==typeof r.end&&r.end(a),a}catch(c){throw"function"==typeof r.err&&r.err(c),c}},performance:function(t){var e=+new Date;t();var o=+new Date;return o-e}}};